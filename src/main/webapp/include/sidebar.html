<%@ page language="java" pageEncoding="UTF-8"%>

<link href="css/plugins/metisMenu/metisMenu.min.css" rel="stylesheet">
<script src="js/plugins/metisMenu/metisMenu.min.js"></script>

<script id="sidebarTemplate" type="text/template">
<div class="navbar-default sidebar" role="navigation">
	<div class="sidebar-nav navbar-collapse">
		<ul class="nav" id="side-menu">
			<li class="sidebar-search">
				<div class="input-group custom-search-form">
					<input type="text" class="form-control" placeholder="Search...">
					<span class="input-group-btn">
						<button class="btn btn-default" type="button">
							<i class="fa fa-search"></i>
						</button>
					</span>
				</div> <!-- /input-group -->
			</li>
			{{~ it.rows : row1}}
				{{var url = row1.url != null ? row1.url : "javascript:void(0);";}}
				<li><a href="{{=url}}" target="main"><i class="fa fa-fw"></i>{{=row1.name}}
				{{? row1.children.length > 0}}<span class="fa arrow"></span>{{?}}</a>
				{{? row1.children.length > 0}}
					<ul class="nav nav-second-level">
					{{~ row1.children : row2}}
						{{var url = row2.url != null ? row2.url : "javascript:void(0);";}}
						<li><a href="{{=url}}" target="main">{{=row2.name}}
						{{? row2.children.length > 0}}<span class="fa arrow"></span>{{?}}</a>
						{{? row2.children.length > 0}}
							<ul class="nav nav-third-level">
							{{~ row2.children : row3}}
								{{var url = row3.url != null ? row3.url : "javascript:void(0);";}}
								<li><a href="{{=url}}" target="main">{{=row3.name}}</a></li>
							{{~}}
							</ul> <!-- /.nav-third-level -->
						{{?}}
						</li>
					{{~}}
					</ul> <!-- /.nav-second-level -->
				{{?}}
				</li>
			{{~}}
		</ul>
	</div>
	<!-- /.sidebar-collapse -->
</div>
<!-- /.navbar-static-side -->
</script>

<script type="text/javascript">
	(function($) {
		var template = doT.template($("#sidebarTemplate").html());

		$.fn._sidebar = function(options) {
			var $this = $(this);
			var opts = jQuery.extend({}, $.fn._sidebar.defaults, options);

			$._ajax(jQuery.extend({}, opts, {
				success : function(result) {
					$this.hide().html(template({
						rows : $._tree({
							rows : result.data.rows
						})
					})).fadeIn(opts.dual);
					$('#side-menu').metisMenu();
				}
			}));

			$this.on("click", "a", function() {
				if ($(this).attr("href") != "javascript:void(0);") {
					$this.find("a").removeClass("active");
					$(this).addClass("active");
				}
			});
		};

		$.fn._sidebar.defaults = {
			url : "/sidebar",
			params : {},
			dual : 1000
		};
	})(jQuery);
</script>